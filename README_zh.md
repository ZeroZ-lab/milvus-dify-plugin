# Milvus æ’ä»¶ (Dify)

ä¸€ä¸ªå°† Milvus å‘é‡æ•°æ®åº“ä¸ Dify å¹³å°é›†æˆçš„æ’ä»¶ï¼Œæä¾›é›†åˆç®¡ç†ã€æ•°æ®æ’å…¥ã€æœç´¢å’ŒæŸ¥è¯¢ç­‰å‘é‡æ“ä½œåŠŸèƒ½ã€‚

[ä¸­æ–‡æ–‡æ¡£](./README_zh.md) | [English](./README.md)

## åŠŸèƒ½ç‰¹æ€§

### ğŸ—‚ï¸ é›†åˆç®¡ç†
- **åˆ—å‡ºé›†åˆ**: æŸ¥çœ‹æ‰€æœ‰å¯ç”¨é›†åˆ
- **æè¿°é›†åˆ**: è·å–é›†åˆçš„è¯¦ç»†ä¿¡æ¯
- **é›†åˆç»Ÿè®¡**: æ£€ç´¢é›†åˆç»Ÿè®¡æ•°æ®
- **æ£€æŸ¥å­˜åœ¨æ€§**: éªŒè¯é›†åˆæ˜¯å¦å­˜åœ¨

### ğŸ“¥ æ•°æ®æ“ä½œ
- **æ’å…¥æ•°æ®**: å‘é›†åˆä¸­æ·»åŠ å‘é‡å’Œå…ƒæ•°æ®ï¼ˆè°ƒç”¨æ–¹éœ€é¢„å…ˆè®¡ç®—å‘é‡ï¼‰
- **æ›´æ–°æ’å…¥æ•°æ®**: æ’å…¥æˆ–æ›´æ–°ç°æœ‰æ•°æ®
- **æŸ¥è¯¢æ•°æ®**: é€šè¿‡ ID æˆ–è¿‡æ»¤æ¡ä»¶æ£€ç´¢æ•°æ®ï¼ˆè‡ªåŠ¨è¯†åˆ«ä¸»é”®å­—æ®µï¼‰
- **åˆ é™¤æ•°æ®**: é€šè¿‡ ID æˆ–è¿‡æ»¤æ¡ä»¶åˆ é™¤æ•°æ®ï¼ˆæ”¯æŒè‡ªå®šä¹‰ä¸»é”®å­—æ®µï¼‰

æ’å…¥æ—¶è¯·ç›´æ¥åœ¨å®ä½“ä¸­æä¾›å‘é‡ï¼Œä¾‹å¦‚ï¼š

```json
[
  {"id": 1, "vector": [0.1, 0.2, 0.3], "metadata": "doc-1"},
  {"id": 2, "vector": [0.4, 0.5, 0.6], "metadata": "doc-2"}
]
```

### ğŸ” å‘é‡æœç´¢
- **ç›¸ä¼¼åº¦æœç´¢**: ä½¿ç”¨å„ç§æŒ‡æ ‡æŸ¥æ‰¾ç›¸ä¼¼å‘é‡
- **è¿‡æ»¤æœç´¢**: ç»“åˆå‘é‡ç›¸ä¼¼åº¦å’Œå…ƒæ•°æ®è¿‡æ»¤
- **å¤šå‘é‡æœç´¢**: ä½¿ç”¨å¤šä¸ªæŸ¥è¯¢å‘é‡è¿›è¡Œæœç´¢
- **è‡ªå®šä¹‰å‚æ•°**: è°ƒæ•´æœç´¢è¡Œä¸ºå‚æ•°

### ğŸ”€ æ··åˆæœç´¢
- å°†å¤šä¸ªå‘é‡å­—æ®µçš„æ£€ç´¢ç»“æœåœ¨ä¸€æ¬¡è¯·æ±‚ä¸­åˆå¹¶ï¼Œå¹¶æŒ‰ç­–ç•¥è¿›è¡Œé‡æ’ã€‚
- æ¥å£è·¯å¾„ï¼š`/v2/vectordb/entities/hybrid_search`ï¼ˆæ’ä»¶ä¼šè‡ªåŠ¨é™„åŠ  `dbName`ï¼‰ã€‚
- Dify å·¥å…·åç§°ï¼šMilvus Hybrid Searchã€‚

å‚æ•°ï¼ˆDify å·¥å…·è¡¨å•ï¼‰
- `collection_name`ï¼ˆå¿…å¡«ï¼‰
- `searches_json`ï¼ˆå¿…å¡«ï¼Œå­—ç¬¦ä¸²ï¼‰ï¼š`search` å¯¹è±¡æ•°ç»„çš„ JSONã€‚æ¯ä¸ªå¯¹è±¡å¿…é¡»åŒ…å«å·²é¢„è®¡ç®—çš„å‘é‡ï¼š
  - `data`ï¼šå‘é‡åµŒå…¥åˆ—è¡¨ï¼ˆé¢„å…ˆè®¡ç®—ï¼‰ï¼Œå¦‚ `[[0.1, 0.2, ...]]`
  - `annsField`ï¼šç›®æ ‡å‘é‡å­—æ®µå
  - `limit`ï¼šè¯¥è·¯æ£€ç´¢çš„ Top-K
  - æ¯è·¯å¯é€‰é”®ï¼ˆæŒ‰ REST æ–‡æ¡£é€ä¼ ï¼‰ï¼š`outputFields`ã€`metricType`ã€`filter`ã€`params`ã€`radius`ã€`range_filter`ã€`ignoreGrowing`
- `rerank_strategy`ï¼ˆä¸‹æ‹‰ï¼‰ï¼š`rrf` æˆ– `weighted`
- `rerank_params`ï¼ˆå¯å¡« JSON å­—ç¬¦ä¸²æˆ–å¯¹è±¡ï¼‰ï¼š`rrf` ç¤ºä¾‹ `{"k": 10}`ï¼›`weighted` ç¤ºä¾‹ `{"weights": [0.6, 0.4]}`
- é¡¶å±‚å¯é€‰ï¼š`limit`ã€`offset`ã€`output_fields`ï¼ˆé€—å·åˆ†éš”å­—ç¬¦ä¸²æˆ– JSON æ•°ç»„ï¼‰ã€`partition_names`ï¼ˆé€—å·åˆ†éš”å­—ç¬¦ä¸²æˆ– JSON æ•°ç»„ï¼‰ã€`consistency_level`ã€`grouping_field`ã€`group_size`ã€`strict_group_size`ï¼ˆå¸ƒå°”ï¼‰ã€`function_score`ï¼ˆJSONï¼‰

å†…ç½®æ ¡éªŒ
- æ¯è·¯æ£€ç´¢å¿…é¡»åŒ…å« `annsField`ï¼ˆéç©ºï¼‰å’Œ `limit`ï¼ˆ> 0 çš„æ•´æ•°ï¼‰ï¼Œå¹¶æä¾› `data`ï¼ˆéç©ºæ•°ç»„ï¼Œæ•°å€¼å‘é‡ï¼‰ã€‚
- å½“ `rerank_strategy = weighted` æ—¶ï¼Œ`rerank_params.weights` å¿…é¡»ä¸ºæ•°å€¼æ•°ç»„ï¼Œä¸”é•¿åº¦ä¸æ£€ç´¢è·¯æ•°ä¸€è‡´ã€‚
- è‹¥æä¾›é¡¶å±‚ `limit`ï¼Œéœ€ç¡®ä¿ `limit + offset < 16384`ï¼ˆæ¥å£é™åˆ¶ï¼‰ã€‚
- `output_fields`ã€`partition_names` å¦‚æœä¸ºå­—ç¬¦ä¸²ï¼Œä¼šæŒ‰é€—å·åˆ‡åˆ†å¹¶å»é™¤ç©ºæ ¼ã€‚

ç¤ºä¾‹
```
searches_json = [
  {
    "data": [[0.12, 0.34, 0.56]],
    "annsField": "vector",
    "limit": 10,
    "outputFields": ["*"]
  }
]
rerank_strategy = rrf
rerank_params = {"k": 10}
limit = 3
output_fields = "user_id,book_title"
```

> å¦‚æœé€šè¿‡ç¼–ç¨‹æ–¹å¼å¡«å……å‚æ•°ï¼Œ`searches_json` å’Œ `output_fields` ä¹Ÿå¯ä»¥ç›´æ¥ä¼ åŸç”Ÿ JSON ç»“æ„ï¼ˆåˆ—è¡¨/å¯¹è±¡ï¼‰ï¼Œæ’ä»¶ä¼šè‡ªåŠ¨åšæ ¼å¼å½’ä¸€ã€‚

## å®‰è£…ä¸é…ç½®

### è¿æ¥é…ç½®
åœ¨ Dify å¹³å°ä¸­é…ç½®æ‚¨çš„ Milvus è¿æ¥:

- **URI**: Milvus æœåŠ¡å™¨åœ°å€ (ä¾‹å¦‚ `http://localhost:19530`)
- **Token**: è®¤è¯ä»¤ç‰Œ (å¯é€‰ï¼Œæ ¼å¼: `username:password`)
- **Database**: ç›®æ ‡æ•°æ®åº“åç§° (é»˜è®¤: `default`)

## è®¸å¯è¯

MIT è®¸å¯è¯ 
